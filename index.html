<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bangsaen AI - Physics-Informed Research Lab</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#151e2e', 900: '#0f172a', 950: '#020617' }
                    }
                }
            }
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        .graph-grid {
            background-size: 40px 40px;
            background-image:
                linear-gradient(to right, rgba(30, 41, 59, 0.5) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(30, 41, 59, 0.5) 1px, transparent 1px);
        }
    </style>
</head>

<body class="bg-slate-900 text-white antialiased selection:bg-green-500 selection:text-black">

    <nav class="fixed w-full z-50 bg-[#0b0e14]/90 backdrop-blur-md border-b border-gray-800">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-20">
                <a href="#" class="flex items-center gap-2 group">
                    <img src="images/logo.png" class="h-8 w-auto" onerror="this.src='https://via.placeholder.com/40'">
                    <span class="font-bold text-xl tracking-tight">Bangsaen<span class="text-green-500">AI</span></span>
                </a>
            </div>
        </div>
    </nav>

    <header class="pt-32 pb-12 text-center bg-[#0b0e14]">
        <h1 class="text-4xl md:text-6xl font-extrabold mb-4">
            Controlling Chaos with <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-green-400">Math</span>
        </h1>
    </header>

    <section id="playground" class="py-16 bg-slate-850 border-t border-slate-800 relative overflow-hidden">
        
        <div class="max-w-7xl mx-auto px-4 relative z-10">
            
            <div class="text-center mb-10">
                <span class="text-green-400 font-mono text-sm tracking-widest uppercase mb-2 block">Interactive Simulation</span>
                <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Prove the Math Yourself</h2>
                <p class="text-slate-400 max-w-2xl mx-auto">
                    Input your hardware parameters below. The simulation will trigger a <strong>Sudden Load Surge (10x Shock)</strong> to test stability.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <div class="lg:col-span-1 bg-slate-900/80 backdrop-blur-sm border border-slate-700 rounded-2xl p-6 shadow-2xl h-fit">
                    <div class="flex items-center gap-3 mb-6 border-b border-slate-700 pb-4">
                        <i class="fas fa-sliders-h text-green-400"></i>
                        <h3 class="font-bold text-lg text-white">Hardware Config</h3>
                    </div>

                    <div class="space-y-6">
                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Inductance (L)</label>
                            <div class="relative">
                                <input type="number" id="input_L" value="2.5" step="0.1" 
                                    class="w-full bg-slate-800 border border-slate-600 rounded-lg py-3 px-4 text-green-400 font-mono focus:outline-none focus:border-green-500 transition-all">
                                <span class="absolute right-4 top-3 text-slate-500 font-mono text-sm">mH</span>
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Capacitance (C)</label>
                            <div class="relative">
                                <input type="number" id="input_C" value="50" step="10" 
                                    class="w-full bg-slate-800 border border-slate-600 rounded-lg py-3 px-4 text-green-400 font-mono focus:outline-none focus:border-green-500 transition-all">
                                <span class="absolute right-4 top-3 text-slate-500 font-mono text-sm">uF</span>
                            </div>
                        </div>

                        <div class="bg-slate-800/50 rounded-lg p-4 border border-red-500/20">
                            <label class="block text-xs font-bold text-red-400 uppercase tracking-wider mb-2">
                                <i class="fas fa-bolt mr-1"></i> Test Scenario
                            </label>
                            <p class="text-sm text-slate-300">
                                Simulating a <strong class="text-white">100Ω ➝ 10Ω</strong> sudden load step (10x Surge) at t=25ms.
                            </p>
                        </div>

                        <button onclick="runWebSimulation()" 
                            class="w-full mt-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold py-4 rounded-lg shadow-lg transform transition active:scale-95 flex items-center justify-center gap-2 group">
                            <i class="fas fa-play text-sm group-hover:animate-pulse"></i> Run Simulation
                        </button>
                    </div>
                </div>

                <div class="lg:col-span-2 bg-[#0b0e14] border border-slate-800 rounded-2xl p-4 relative shadow-2xl flex flex-col">
                    <div class="relative flex-1 min-h-[400px] w-full">
                        <canvas id="stabilityChart"></canvas>
                    </div>
                    
                    <div class="flex justify-between items-center mt-4 border-t border-slate-800 pt-3 px-2">
                        <div class="text-xs font-mono text-slate-500">
                            Auto-Tuning Gain (K): <span id="k_value" class="text-green-400">-</span>
                        </div>
                        <div class="text-xs font-mono text-slate-500">
                            STATUS: <span class="text-blue-400 animate-pulse">READY</span>
                        </div>
                    </div>
                </div>

            </div>

            <div class="mt-12 text-center">
                <p class="text-slate-400 mb-4 text-sm">See the difference? PID crashes. BangsaenAI holds.</p>
                <div class="flex justify-center gap-4">
                    <button class="px-6 py-3 rounded-lg border border-green-500 text-green-400 font-semibold hover:bg-green-500/10 transition-colors">
                        Get API Key
                    </button>
                    <button class="px-6 py-3 rounded-lg bg-slate-700 text-white font-bold hover:bg-slate-600 transition-colors">
                        Contact Enterprise
                    </button>
                </div>
            </div>

        </div>
    </section>

    <footer class="border-t border-slate-800 py-8 bg-slate-950 text-center text-slate-600 text-sm">
        Bangsaen AI Research Laboratory &copy; 2025
    </footer>

    <script>
        let myChart = null;

        function runWebSimulation() {
            // 1. รับค่า Input Hardware จากลูกค้า
            const L = parseFloat(document.getElementById('input_L').value) * 1e-3; // Convert to Henry
            const C = parseFloat(document.getElementById('input_C').value) * 1e-6; // Convert to Farad
            
            // 2. คำนวณ Auto-Tuning (จำลองความฉลาดของ API)
            // Z0 คือ Characteristic Impedance รากที่สองของ L/C
            const Z0 = Math.sqrt(L/C);
            const K_gain = (Z0 * 1.5).toFixed(2); // สูตร Heuristic ง่ายๆ สำหรับ Demo
            document.getElementById('k_value').innerText = `[${K_gain}, 0.8]`;

            // 3. เตรียมตัวแปร Simulation
            const dt = 50e-6; // 50us sampling
            const steps = 1000; // 50ms total time
            const timeData = [];
            const pidData = [];
            const kksData = [];

            // Initial States (เริ่มที่ 311V นิ่งๆ)
            let v_pid = 311;
            let v_kks = 311;
            let iL_pid = 311 / 100;
            let iL_kks = 311 / 100;
            let target = 311;

            // PID Memory
            let pid_integral = 0;
            let pid_prev_error = 0;

            // Loop คำนวณ Physics (เหมือน Python เป๊ะ แต่รันใน JS)
            for (let i = 0; i < steps; i++) {
                let t = i * dt;
                timeData.push((t * 1000).toFixed(1)); // เก็บเวลาหน่วย ms

                // --- SCENARIO: Load Surge ที่ 25ms ---
                let R = (t > 0.025) ? 10 : 100; // เปลี่ยนจาก 100 ohm เป็น 10 ohm

                // --- 1. PID Calculation (แบบบ้านๆ) ---
                let error = target - v_pid;
                pid_integral += error * dt;
                let derivative = (error - pid_prev_error) / dt;
                let u_pid = (0.5 * error) + (20 * pid_integral) + (0.001 * derivative); // Kp, Ki, Kd
                pid_prev_error = error;
                
                // Physics Update PID Plant
                // dv/dt = (iL - v/R)/C
                // di/dt = (u - v)/L
                let dv_pid = (iL_pid - (v_pid / R)) / C;
                let di_pid = (u_pid - v_pid) / L; // u_pid คือแรงดันที่จ่ายเข้าไป
                
                v_pid += dv_pid * dt;
                iL_pid += di_pid * dt;

                // --- 2. KKS Calculation (Bangsaen AI) ---
                // สูตรลับ: Feedforward Current Injection
                // เรารู้ R เราคำนวณกระแสที่ต้องใช้เลย i_req = V_target / R
                let i_req = target / R;
                let err_i = i_req - iL_kks;
                let err_v = target - v_kks;
                
                // Control Law: อัดแรงดันเพิ่มตามความต้องการกระแส (Gain แปรผันตาม L/C)
                let u_kks = target + (K_gain * err_i) + (0.8 * err_v); 

                // Physics Update KKS Plant
                let dv_kks = (iL_kks - (v_kks / R)) / C;
                let di_kks = (u_kks - v_kks) / L;

                v_kks += dv_kks * dt;
                iL_kks += di_kks * dt;

                // เก็บผลลัพธ์ใส่ Array
                pidData.push(v_pid);
                kksData.push(v_kks);
            }

            // 4. วาดกราฟด้วย Chart.js
            drawGraph(timeData, pidData, kksData);
        }

        function drawGraph(labels, dataPID, dataKKS) {
            const ctx = document.getElementById('stabilityChart').getContext('2d');
            
            if (myChart) myChart.destroy(); // ลบกราฟเก่าถ้ามี

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Standard PID (Voltage Drop)',
                            data: dataPID,
                            borderColor: '#ef4444', // สีแดง
                            borderWidth: 2,
                            pointRadius: 0,
                            tension: 0.4
                        },
                        {
                            label: 'Bangsaen AI (Stable)',
                            data: dataKKS,
                            borderColor: '#4ade80', // สีเขียว
                            borderWidth: 3,
                            pointRadius: 0,
                            tension: 0.1 // เส้นคมๆ ไม่ย้วย
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index',
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Time (ms)', color: '#64748b' },
                            grid: { color: '#1e293b' },
                            ticks: { color: '#94a3b8' }
                        },
                        y: {
                            title: { display: true, text: 'Voltage (V)', color: '#64748b' },
                            grid: { color: '#1e293b' },
                            ticks: { color: '#94a3b8' },
                            suggestedMin: 200,
                            suggestedMax: 350
                        }
                    },
                    plugins: {
                        legend: { labels: { color: '#fff' } },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#334155',
                            borderWidth: 1
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
